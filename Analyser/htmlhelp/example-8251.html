<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
  <title></title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="author" content="VAN">
  <meta name="generator" content="Quanta Plus">
</head>
<body>

<a name="vv51test"></a>
<h1>5.3. КР580ВВ55 в режиме 1</h1>

<p style="text-align: justify">Используемая для проверки схема опять-таки содержит процессор. 
Системного контроллера здесь нет, а управляющие сигналы формируются с
помощью обычных логических элементов.
</p>
 
<p>Схема:</p>

<img src="images/samples/image007.png" width="1001" height="640" alt="" border="0">

Некоторые используемые на схеме элементы:

<ol>
<li>DD1 – микропроцессор КР580ВМ80А;</li>
<li>DD2 – ОЗУ. Используется для хранения выполняемой программы;</li>
<li>DD3 – байтовый регистр, используемый для хранения байта состояния, 
выводимого процессором в начале каждого цикла и идентифицирующего тип 
цикла. С использованием разрядов байта состояния и выходов процессора 
DBIN и  формируются управляющие сигналы  (чтение памяти),  (запись в память),  
(чтение порта ввода/вывода),  (запись в порт ввода/вывода) и  (подтверждение прерывания).
Эти же сигналы могли бы быть получены с помощью системного контроллера ВК28. </li>
<li>DD13 – ППИ КР580ВВ55А. Т.к. у нас имеется только один ППИ, 
сигнал выбора микросхемы  можно сформировать просто: , т.к. 
дешифратор адресов здесь не требуется. Входы A0, A1 подключены 
к двум младшим разрядам шины адреса. </li>
<li>DD15 – шинный формирователь. Используется для выдачи кода 
операции RST.7 при наличии активного уровня на  (т.е. когда процессор 
запрашивает код операции при прерывании). Код операции задается блоком 
переключателей слева от него. </li>
<li>Осциллограф – используется для наблюдения временных диаграмм. </li>
</ol>

<p style="text-align: justify">В качестве внешнего устройства, с которого осуществляется ввод, 
используется линейка переключателей (для задания байта) и одиночный 
переключатель (для выработки строба приема). Роль устройства вывода 
играет линейка светодиодов и переключатель для выработки сигнала 
подтверждения приема. При приходе байта от внешнего устройства процессор 
получает сигнал INT с вывода КС0 ППИ, обрабатывает прерывание (вводит байт 
из канала B и выводит его в канал A). Вывод КС3 ППИ не подключен к процессору 
(хотя сигнал прерывания и генерируется, он ничем не воспринимается, кроме 
осциллографа и лампочки).
</p>
 
<p>Программа, выполняемая процессором:</p>

<table border="2" bgcolor="white">
<tr><td><b>Адрес</b></td>
<td><b>Мнемоника</b></td>
<td><b>Комментарий</b></td>
</tr> 

<tr><td><b>Точка входа</b></td></tr>
 
<tr><td>0000h</td>
<td>LXI SP, 1FFFCh</td>
<td>Установка указателя стека для правильной обработки прерываний</td>
</tr> 

<tr><td>0003h</td>
<td>JMP 0100h</td>
<td>Переход на код инициализации ППИ</td>
</tr> 

<tr><td><b>Процедура обработки прерываний (ISR)</b></td></tr>
 
<tr><td>0038h</td>
<td>PUSH PSW</td>
<td>Сохранение слова состояния МП в стек</td>
</tr> 

<tr><td>0039h</td>
<td>IN 01h</td>
<td>Чтение байта из порта 1 (т.е. из буфера канала B ППИ) в аккумулятор </td>
</tr> 

<tr><td>003Bh</td>
<td>OUT 00h</td>
<td>Запись байта из аккумулятора в порт 0 (т.е. в буфер канала А ППИ);</td>
</tr> 

<tr><td>003Dh</td>
<td>POP PSW</td>
<td>Восстановление слова состояния МП из стека</td>
</tr> 

<tr><td>003Eh</td>
<td>EI</td>
<td>Разрешение обработки прерываний.</td>
</tr> 

<tr><td>003Fh</td>
<td>RET</td>
<td>Возврат из ISR в точку выполнения прерванной программы</td>
</tr> 

<tr><td><b>Код инициализации ППИ</b></td></tr>
 
<tr><td>0100h</td>
<td>MVI A, 0A7h</td>
<td>Загрузка в аккумулятор значения управляющего слова ППИ, 
соответствующего следующей конфигурации: каналы А и B в режиме 1, 
канал B настроен на ввод, канал A – на вывод. </td>
</tr> 

<tr><td>0102h</td>
<td>OUT 03h</td>
<td>Вывод содержимого аккумулятора в порт 3 (т.е. в РУС, т.к. старший разряд байта в аккумуляторе установлен)</td>
</tr>
 
<tr><td>0104h</td>
<td>MVI A, 04h</td>
<td>Загрузка в аккумулятор кода команды сброса разряда КС2 ППИ. </td>
</tr> 

<tr><td>0106h</td>
<td>OUT 03h</td>
<td>Вывод команды в порт 3 (т.е. ее выполнение интерфейсом ВВ55)</td>
</tr> 

<tr><td>0108h</td>
<td>MVI A, 0Ch</td>
<td>Загрузка в аккумулятор кода команды сброса разряда КС6</td>
</tr> 

<tr><td>010Ah</td>
<td>OUT 03h</td>
<td>Вывод команды в порт 3</td>
</tr> 

<tr><td>010Ch</td>
<td>MVI A, 05h</td>
<td>Загрузка в аккумулятор кода команды установки разряда КС2 в 1. 
В режиме 1 эта команда разрешает генерацию сигнала запроса прерывания от порта B ППИ при вводе</td>
</tr> 

<tr><td>010Eh</td>
<td>OUT 03h</td>
<td>Вывод команды в порт 3</td>
</tr> 

<tr><td>0110h</td>
<td>MVI A, 0Dh</td>
<td>Загрузка в аккумулятор кода команды установки разряда КС6 в 1. 
В режиме 1 эта команда разрешает генерацию сигнала запроса прерывания от порта А ППИ при выводе
</td></tr> 

<tr><td>0112h</td>
<td>OUT 03h</td>
<td>Вывод команды в порт 3</td>
</tr> 

<tr><td>0114h</td>
<td>EI</td>
<td>Разрешение обработки прерываний процессором</td>
</tr> 

<tr><td>0115h</td>
<td>NOP</td>
<td>Нет операций</td>
</tr> 

<tr><td>0116h</td>
<td>JMP 0115h</td>
<td>Бесконечный цикл – во время его выполнения могут приходить и обрабатываться прерывания</td>
</tr> 
</table>

<p style="text-align: justify">Используя осциллограф, можно наблюдать следующие временные диаграммы:</p>

<img src="images/samples/image013.gif" width="359" height="210" alt="" border="0">

<p>Обозначения сигналов здесь значат следующее:</p>

<ol>
  <li>ISTB – строб приема данных для канала B (KC2);</li>
  <li>IACK – сигнал подтверждения приема данных для канала B (КС1);</li>
  <li>INT – сигнал запроса прерывания для канала B при вводе (КС0);</li>
  <li>IOR – управляющий сигнал чтения порта ввода/вывода процессором (вход RD ППИ);</li>
  <li>IOW – управляющий сигнал записи в порт ввода/вывода процессором (вход WR ППИ);</li>
  <li>INT_KA – сигнал запроса прерывания для канала A при выводе (КС3);</li>
  <li>OSTB – строб записи данных для канала А (КС7);</li>
  <li>OACK – сигнал подтверждения записи для канала А (КС6).</li>
</ol>
 
<p style="text-align: justify">В некоторый момент времени внешнее устройство хочет ввести байт 
данных в канал ППИ. Для этого оно устанавливает ISTB=0. 
ППИ обнаруживает это и считывает данные со входов КВ, помещая их в 
буфер канала B. По окончании считывания ППИ выставляет сигнал IACK=1, 
давая ВУ знать о том, что чтение завершилось, и буфер КИ занят байтом данных 
(т.е. этот сигнал можно трактовать как сигнал занятости). После этого ВУ может
перевести ISTB обратно в уровень «1». При этом ППИ генерирует сигнал запроса 
прерывания INT=1, если это разрешено. Этот сигнал снимается при последующем 
чтении процессором байта из канала B (при переходе уровня на RD с «1» на «0»), 
чтобы не вызывать последующих прерываний для этого байта. При переходе уровня на 
RD обратно в «1» ППИ также устанавливает уровень на IACK в 0, чтобы уведомить ВУ 
о готовности принять очередной байт.</p>

<p style="text-align: justify">Выполняя ISR, процессор через некоторое время выдает байт данных в канал А, выставляя 
WR=0. Это приводит к сбросу (т.е. установке в «0») сигнала запроса прерывания для канала А. 
При переходе WR в «1» ППИ вырабатывает сигнал строба записи (здесь OSTB), который 
держится до тех пор, пока ВУ не выдаст сигнал подтверждения записи (OACK=0). После 
перехода OACK обратно в «1» выдается сигнал запроса прерывания (высокий уровень) 
для информирования процессора об окончании записи.</p>

</body>
</html>