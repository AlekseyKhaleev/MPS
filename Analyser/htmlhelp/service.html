<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
  <title></title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="author" content="VAN">
  <meta name="generator" content="Quanta Plus">
</head>
<body>	

<a name="top"></a>

<a name="service"><h1><div style="text-align: center">3.6. Служебные элементы</div></h1></a>

<a name="pipe"></a>
<h4>3.6.1. Канал передачи данных</h4>

<p>
<img src="images/elements/image089.png" width="381" height="313" alt="" border="0">
<img src="images/elements/image091.png" width="136" height="181" alt="" border="0" align="top">
</p>

<p style="text-align: justify">Назначение выводов (более подробное описание приведено после таблицы):</p>

<table border="2">
  <tbody>
    <tr>
      <td><strong>Вывод</strong></td>
      <td><strong>Назначение</strong></td>
    </tr>
    <tr>
      <td>DI0-DI7</td>
      <td>Входы данных. На эти входы должны приходить отправляемые в канал байты. DI7-старший разряд</td>
    </tr>
    <tr>
      <td>DO0-DO7</td>
      <td>Выходы данных (трехстабильные). Сюда будут выдаваться принятые из канала байты данных</td>
    </tr>
    <tr>
      <td>RD</td>
      <td>Управляющий вход для сигнала чтения байтов. Управляется динамически, по перепаду L->H</td>
    </tr>
    <tr>
      <td>WR</td>
      <td>Управляющий вход для сигнала записи байтов. Управляется динамически, по перепаду L->H</td>
    </tr>
    <tr>
      <td>CS</td>
      <td>Управляющий вход выбора микросхемы (chip select). Активный уровень - низкий (L). 
          Если CS неактивен, элемент не реагирует на сигналы RD и WR, а линии DO0-DO7 находятся в Z-состоянии</td>
    </tr>
    <tr>
      <td>RDYR</td>
      <td>Выход, показывающий готовность чтения. Активный уровень - низкий</td>
    </tr>
    <tr>
      <td>RDYW</td>
      <td>Выход, показывающий готовность записи. Активный уровень - низкий</td>
    </tr>
  </tbody>
</table>

<p style="text-align: justify">Специальный "элемент" для работы с именованными 
программными каналами (<b>pipe</b>) Windows NT. Может использоваться для 
связи между несколькими запущенными экземплярами Analiser'а. Работает в 
полнодуплексном режиме, может одновременно передавать и принимать данные 
(по одному байту за раз) и имитировать работу полнодуплексного 
параллельного канала данных (буферизованного или нет). Может передавать данные между разными машинами в сети. 
</p> 

<p style="text-align: justify">Чтение производится при наличии активного (низкого) 
уровня на выходе <b>RDYR</b> (т.е. когда данные пришли) и перепаде <b>L->H</b> на <b>RD</b>. 
В этом случае байт извлекается из программного канала и держится на выходах <b>DOUT</b> 
(на условном обозначении <b>DO</b>)
до следующего чтения. Если при перепаде <b>L->H</b> на <b>RD</b> данные не готовы, на линиях <b>DOUT</b> 
будут уровни логического нуля.
</p>

<p style="text-align: justify">Запись производится при наличии активного (низкого) уровня 
на выходе <b>RDYW</b> (т.е. когда возможна передача данных) и перепаде <b>L->H</b> на <b>WR</b>. 
В этом случае байт с входов <b>DIN</b> (на условном обозначении DI) помещается во входной 
системный FIFO-буфер программного канала, где и будет храниться до извлечения. 
Если при записи на <b>RDYW</b> неактивный уровень 
(т.е. буфер полон), ничего никуда записано не будет.
</p>

<p style="text-align: justify">Следует обратить внимание на то, что
одним программным каналом могут одновременно пользоваться только два элемента, 
не больше и не меньше. Кроме того, на Windows 9x именованные программные каналы вообще не поддерживаются 
(во всяком случае, их создание: см Win32 Programmer's Reference).
</p>

<nobr>Если указать размер буфера в 0 или 1, канал становится небуферизованным.</nobr>

<p style="text-align: justify">При наличии высокого уровня на входе <b>CS</b> выходы <b>DO</b> находятся в состоянии Z.</p>

<p style="text-align: justify">При создании канала имя его должно иметь вид:</p>

<p><table border="1"><tr><td bgcolor="white">
<font face="Courier New"> 
\\имя-хоста\pipe\имя-канала
</font></td></tr></table>
</p>

<p style="text-align: justify">
Для текущей (не удаленной машины) имя-хоста состоит 
из одной точки. Т.е. для соединения через сеть на одной машине нужно 
создать канал с именем <b>\\.\pipe\имя-канала</b>, а на другой <b>\\имя-первой-машины\pipe\имя-канала</b>.
</p>

<p style="text-align: justify">
В этом случае нужно учитывать также то, что у текущего подключающегося пользователя должны быть
права на использование удаленного программного канала. Если имя учетной записи и пароль
на локальной и удаленной машине совпадают, никаких дополнительных действий производить 
не надо, т.к. сработает сквозная аутентификация Windows и канал будет доступен. Однако эта учетная запись
должна быть записью пользователя, создавшего канал. 
</p>

<p style="text-align: justify">
Если подключить канал не удается (в подписи к УГО программа отображает "Ошибка"), возможно, 
нужно явно провести аутентификацию. Для этого следует ввести следующую команду, используя
командный интерпретатор Windows (cmd.exe):
</p>

<p><table border="1"><tr><td bgcolor="white">
<font face="Courier New"> 
net use \\имя-хоста\IPC$ /user:имя-пользователя-создавшего-канал
</font></td></tr></table>
</p>

<p style="text-align: justify">
Windows спросит пароль на учетную запись. После выполнения команды
канал должен стать доступным. После завершения работы подключенный ресурс IPC$
можно отключить командой 
</p>

<p><table border="1"><tr><td bgcolor="white">
<font face="Courier New"> 
net use \\имя-хоста\IPC$ /d
</font></td></tr></table>
</p>
 
<p style="text-align: justify">Параметр «Интервал опроса» показывает, с какой частотой запрашивать 
систему о наличии пришедших данных. Чем меньше, тем более гладко будет 
выполняться передача, но тем больше загрузка процессора. Ноль указывать нельзя.
</p>

<p style="text-align: justify">
Параметр "Задержка I/O" показывает задержку между подачей управляющего сигнала (чтения или записи)
и появлением результата на выходах элемента.
</p>

<a name="pipe-serial"></a>
<h4>3.6.2. Канал передачи данных - последовательный</h4>

<img src="images/elements/image097.png" width="132" height="99" alt="" border="0">

<p style="text-align: justify">Аналог <a href="#pipe">предыдущего канала</a>, но только с одной линией для данных. 
В остальном поведение то же.</p>

<a name="pipe-simple"></a>
<h4>3.6.3. Канал передачи данных - простой</h4>

<img src="images/elements/image099.png" width="102" height="138" alt="" border="0">

<p style="text-align: justify">Этот элемент тоже использует программные каналы для передачи данных 
между процессами или даже по сети. DI – входы, DO – выходы. Никаких управляющих 
сигналов тут нет. Любое изменение уровней на входах будет отправлено по каналу; 
оно проявится с другой стороны канала.
</p>

<p style="text-align: justify">Этот элемент также может передавать данные в обе стороны одновременно.</p>

<p style="text-align: justify">Свойства у него те же, что и у предыдущих элементов;</p>

<p style="text-align: justify">Если удаленный конец канала не принимает данные, 
буфер передачи когда-нибудь заполнится, и последние изменения уровней отсылаться не будут.
</p>

<a name="pipe-simple-serial"></a>
<h4>3.6.4. Канал передачи данных - простой, последовательный</h4>

<img src="images/elements/image101.png" width="113" height="53" alt="" border="0">

<p style="text-align: justify">Это аналог предыдущего, только с одной линией. 
По сути, два провода, «протянутых» между процессами 
(два последовательных канала, передающих данные в разные стороны).
</p>

<a name="random8"></a>
<h4>3.6.5. Генератор ПСЧ (8-разрядный)</h4>

<img src="images/elements/image103.png" width="112" height="139" alt="" border="0">

<p style="text-align: justify">Генератор псевдослучайных байтовых чисел. Реализован как обычный конгруэнтный генератор.</p>

<p style="text-align: justify">При перепаде <b>L->H</b> на входе RES инициализируется случайным значением. 
При перепаде <b>L->H</b> на входе C генерируется новое число, которое выводится на выходы <b>D7-D0</b>. 
Вход <b>CS</b> служит для отключения выходов. Когда на нем высокий уровень, выходы переводятся в Z-состояние.
</p>

<a name="random1"></a>
<h4>3.6.6. Генератор ПСЧ (одноразрядный)</h4>

<img src="images/elements/image106.png" width="105" height="84" alt="" border="0">

<p style="text-align: justify">Этот элемент аналогичен предыдущему. 
Однако выходная линия только одна: этот генератор предназначен 
для генерации импульсов с заданной вероятностью (вероятность настраивается).
</p>

<p style="text-align: justify">При перепаде <b>L->H</b> на входе <b>C</b> на выход 
выводится высокий уровень с заданной вероятностью.
</p>

<a name="printer"></a>
<h4>3.6.7. Принтер</h4>

<img src="images/elements/image108.png" width="178" height="172" alt="" border="0">

<p style="text-align: justify">Внешнее устройство со встроенным буфером FIFO. </p>

<p style="text-align: justify">Выход <b>RDY</b> показывает, когда в буфере есть место 
(активный уровень говорит о готовности принять еще байт).
</p>

<p style="text-align: justify">При перепаде <b>L-->H</b> на входе <b>WR</b> байт 
добавляется в конец очереди, если в ней есть место. 
Начало очереди выводится на самом УГО принтера при работе. 
</p>

<p style="text-align: justify">Настраиваемые параметры:</p>
<ul>
    <li>
        <b>Имя приемника данных</b> - имя файла, в который будет выводиться результат печати.
    </li>
    <li>
        <b>Время вывода символа</b> - время (в наносекундах), затрачиваемое принтером на вывод одного обычного
        печатного символа.
    </li>
    <li>
        <b>Время возврата каретки</b> - время (в наносекундах) на перевод печатающей головки на начало строки 
        (время печати символа 0xD).
    </li>
    <li>
        <b>Время перевода строки</b> - время (в наносекундах) на переход на следующую строку 
        (время печати символа 0xA).
    </li>
    <li>
        <b>Задержка H->L RDY</b> - время (в наносекундах) на смену состояния выхода RDY при 
        изменении готовности принтера.
    </li>
    <li>
        <b>Размер буфера</b> - размер FIFO-буфера принтера в байтах.
    </li>
</ul>

<a name="sprinter"></a>
<h4>3.6.8. Принтер с последовательным интерфейсом</h4>

<img src="images/elements-new/sprinter.png">

<p style="text-align: justify">Внешнее устройство со встроенным буфером FIFO. 
Принимает данные в последовательном виде с использованием протокола
асинхронного режима передачи данных КР580ВВ51</p>

<p style="text-align: justify">Контакты компонента:</p>
<table border="1">
    <tr>
        <td><b>Обозначение</b></td>
        <td><b>Вход/выход</b></td>
        <td><b>Функциональное назначение</b></td>
    </tr>
    <tr>
        <td>RxD</td>
        <td>вход</td>
        <td>Линия приема данных в последовательном виде</td>
    </tr>
    <tr>
        <td>RxC</td>
        <td>вход</td>
        <td>Синхронизация приема данных</td>
    </tr>
    <tr>
        <td>RDY</td>
        <td>выход</td>
        <td>Готовность принтера (активный низкий уровень показывает о наличие в буфере принтера свободного места)</td>
    </tr>    
</table>

<p style="text-align: justify">Формат кадра:</p>
<ul>
    <li>
	     Старт-бит (низкий уровень).
	</li>
	<li>
	     8 бит данных - печатаемый символ.
	</li>
	<li>
	     Бит контроля четности (если включен контроль четности в свойствах принтера). 
		 Проверка осуществляется именно на четность, т.е. число выставленных в единицу 
		 бит данных в кадре вместе с битом контроля должно быть четным.
	</li>
	<li>
	     Стоп-бит (высокий уровень). Число стоп-битов (1, 1.5, 2) не принципиально.
	</li>
</ul>

<p style="text-align: justify">Настраиваемые параметры:</p>
<ul>
    <li>
        <b>Имя приемника данных</b> - имя файла, в который будет выводиться результат печати.
    </li>
    <li>
        <b>Время вывода символа</b> - время (в наносекундах), затрачиваемое принтером на вывод одного обычного
        печатного символа.
    </li>
    <li>
        <b>Время возврата каретки</b> - время (в наносекундах) на перевод печатающей головки на начало строки 
        (время печати символа 0xD).
    </li>
    <li>
        <b>Время перевода строки</b> - время (в наносекундах) на переход на следующую строку 
        (время печати символа 0xA).
    </li>
    <li>
        <b>Задержка H->L RDY</b> - время (в наносекундах) на смену состояния выхода RDY при 
        изменении готовности принтера.
    </li>
    <li>
        <b>Размер буфера</b> - размер FIFO-буфера принтера в байтах.
    </li>
    <li>
        <b>Контроль четности</b> - если установлен в 1, принтер считывает и проверяет биты
        контроля четности. Если установлен в 0, принимаемые кадры данных не должны содержать
        биты контроля четности.
    </li>    
</ul>

<a name="input"></a>
<h4>3.6.9. Устройство ввода символов</h4>

<img src="images/elements/image113.png" width="129" height="173" alt="" border="0">

<p style="text-align: justify">Служит для ввода ASCII-кодов символов с 
клавиатуры ПК. Когда этот элемент выделен, коды нажатых 
клавиш добавляются во встроенный буфер FIFO элемента 
(размер настраивается).</p>

<p style="text-align: justify">Перепад <b>L->H</b> на входе <b>RES</b> приводит к очистке буфера. </p>

<p style="text-align: justify">Аналогичный перепад на <b>RD</b> приводит 
к выдаче кода прочитанной клавиши на выходы 
<b>D7-D0</b> и удалению его из очереди. 
</p>

<p style="text-align: justify">Выход <b>RDY</b> показывает, есть ли символы в буфере. 
Если да, на этом выходе будет низкий уровень;
</p>

<p style="text-align: justify">Выход <b>FULL</b> показывает, заполнен ли 
буфер полностью. Если да, на этом выходе будет низкий уровень.
</p>

<a name="keyboard"></a>
<h4>3.6.10. Клавиатура</h4>

<img src="images/elements/image117.png" width="201" height="169" alt="" border="0">

<p style="text-align: justify">Это 64-клавишная клавиатура со встроенным дешифратором строк. </p>

<p style="text-align: justify">Входы <b>R0-R2</b> определяют номер сканируемой в данный момент строки. 
При этом на выходах будут присутствовать уровни H на тех, которые 
соответствуют нажатым клавишам. На остальных будут низкие уровни. 
</p>

<p style="text-align: justify">Выход <b>ST</b> при этом устанавливается в уровень 
единицы в том случае, когда в текущей строке есть хотя бы одна нажатая клавиша.
</p>

<p style="text-align: justify">Клавиши можно нажимать мышью как во время разработки схемы, так и во время симуляции.</p>

<a name="keyboard-simple"></a>
<h4>3.6.11. Клавиатура (простая)</h4>

<IMG src="images/elements-new/keyboard.png" width="205" height="173" align="left" border="0">

<p style="text-align: justify">Это 64-клавишная клавиатура без встроенного дешифратора строк. </p>

<p style="text-align: justify">Входы определяют номер сканируемой в данный момент строки. 
Не более чем на одном входе должен присутствовать уровень H, такой вход показывает 
сканируемую строку. 
При этом на выходах будут присутствовать уровни H на тех, которые 
соответствуют нажатым клавишам. На остальных будут низкие уровни. 
</p>

<p style="text-align: justify">Выход <b>ST</b> при этом устанавливается в уровень 
единицы в том случае, когда в текущей строке есть хотя бы одна нажатая клавиша.
</p>

<a name="textlabel"></a>
<h4>3.6.12. Текст</h4>

<p style="text-align: justify">Этот элемент служит всего лишь для добавления 
текстовой пометки на схему. Помимо выдаваемого текста, можно настроить шрифт. 
</p>

<a name="speaker"></a>
<h4>3.6.13. Динамик</h4>

<img src="images/elements/image119.png" width="70" height="80" alt="" border="0">

<p style="text-align: justify">Этот элемент проигрывает заданный WAV-файл, 
когда на его вход приходит фронт импульса. Имя файла задается в странице свойств
элемента, вызываемой, как обычно, нажатием правой кнопки мыши на УГО элемента
(для быстрого выбора файла можно вызвать диалог выбора, дважды щелкнув мышью
на полосе ввода имени файла).
</p>
	
<a name="buslocker"></a>
<h4>3.6.14. Шинный формирователь</h4>

<img src="images/elements/image121.png" width="106" height="138" alt="" border="0">

<p style="text-align: justify">Обычный однонаправленный шинный формирователь. Когда на входе <b>CS</b>
уровень нуля, на выходы <b>DO0-DO7</b> подаются данные, приходящие на входы <b>DI0-DI7</b>. 
Если на <b>CS</b> высокий уровень, выходы <b>DO0-DO7</b> находятся в Z-состоянии.
</p>

<a name="buslocker-bidi"></a>
<h4>3.6.15. Шинный формирователь (двунаправленный)</h4>

<img src="images/elements/image124.png" width="100" height="152" alt="" border="0">

<p style="text-align: justify">Этот шинный формирователь может передавать данные в обоих
направлениях. Это определяется состоянием входа <b>T</b>. Когда на <b>T</b> высокий уровень, 
данные передаются от <b>DO0-DO7</b> к <b>DI0-DI7</b>. Иначе наоборот.
Вход <strong>CS</strong> показывает состояние выходов. Если <strong>CS</strong> неактивен (H), 
выходы находятся в Z-состоянии.
</p>

<a name="file"></a>
<h4>3.6.16. Элемент для чтения данных из файла</h4>

<IMG src="images/elements-new/file.gif" width="172" height="166" border="0">

<p style="text-align: justify">
Позволяет читать последовательно байты из заданного файла. При активном (низком) уровне
на входе CS на выходах D<sub>i</sub> отображается последний считанный из файла байт
(если еще ничего считано не было, отображается ноль). 
Перепад L->H на входе RD приводит к чтению байта из файла. При этом, если CS активен, 
считанный байт выдается на выходы D<sub>i</sub>.
</p>

<p style="text-align: justify">
При достижении конца файла на выходе EOF появляется высокий уровень. Также высокий
уровень на EOF наблюдается при отсутствии заданного файла или при невозможности
его открытия.
</p>

<p style="text-align: justify">
В любой момент можно начать чтение файла заново, подав перепад L->H
на вход REWIND. При этом на EOF будет низкий уровень, если, конечно, файл не пуст.
</p>

<a name="display"></a>
<h4>3.6.17. Дисплей</h4>

<IMG src="images/elements-new/display1.png" width="226" height="241" border="0">

<p style="text-align: justify">
Растровый дисплей, позволяющий отображать цветные и черно-белые изображения.
Изображение рисуется построчно, причем в каждой строке последовательно выводятся 
пиксели, начиная от левого. Изображение отображается в отдельном окне, но может
также выводиться в самом УГО элемента.
</p>

<p style="text-align: justify">
Перепад L->H на входе SYN приводит к рисованию очередного пикселя. При этом, 
если вход BW подключен к шине, то при высоком уровне на нем рисуется белый пиксель,
а при низком - черный. Если подключен вход RGB, данные с него используются для рисования
цветных пикселей. Происходит это следующим образом. Цвет представляется 24-битным целым числом,
три байта которого содержат цветовые компоненты RGB. Красную компоненту характеризует младший
байт, синюю - старший. На вход RGB данные о цвете приходят последовательно, начиная с младшего
разряда. Т.е. для рисования одного пикселя требуется 24 тактов SYN, из которых первые 8
происходит считывание красной компоненты, следующие 8 - зеленой и т.д. Поэтому рисование
цветных изображения происходит весьма медленно, лучше использовать для него другие варианты дисплея.
</p>

<p style="text-align: justify">
Перепад L->H на входе RST приводит к смещению текущей позиции рисования в левый верхний 
угол дисплея.
</p>

<p style="text-align: justify">
Перепад L->H на входе NL приводит к окончанию рисования текущей строки и началу рисования следующей.
</p>

<p style="text-align: justify">
Изображение выводится в отдельное окно, которое можно вывести на экран, нажав правую кнопку мыши
на УГО дисплея. Это окно может выглядеть, например, так:
</p>

<IMG src="images/elements-new/displaywindow.png" width="250" height="238" border="0">

<p style="text-align: justify">
Есть возможность изменения масштаба изображения в окне. Следует отметить,
что рисование изображения при измененном масштабе происходит намного медленнее.
Также из этого окна можно вызвать страницу свойств дисплея. Она выглядит так:
</p>

<IMG src="images/elements-new/displayprop.png" width="472" height="315" border="0">

<p style="text-align: justify">
Настраиваемые параметры:
<ul>
 <li>Размер изображения. Он не может превышать 700 и не может быть меньше 8 по каждой координатной оси</li>
 <li>Включение (1)/выключение (0) рисования на УГО. Изображение может отображаться на УГО, если это включить
     (по умолчанию включено). Можно выключить эту опцию для улучшения производительности</li>
 <li>Масштабирование изображения на УГО. Если оно включено (значение равно 1), то все изображение на дисплее  
     масштабируется до размера УГО и отображается на нем. Иначе (0) отображается только левая верхняя часть</li>
 <li>Период обновления УГО. Задает минимальное время между обновлениями УГО в миллисекундах. Меньшие значения
     приводят к более "оперативному" обновлению УГО на схеме, однако также вызывают потерю производительности</li>
 <li>Плавное масштабирование. Если включено, используется более качественное, но более ресурсоемкое 
     масштабирование при отображении на окне или в УГО</li>
</ul>
</p>

<a name="display-irgb"></a>
<h4>3.6.18. Дисплей 16-цветный IRGB</h4>

<IMG src="images/elements-new/display2.png" width="233" height="235" border="0">

<p style="text-align: justify">
Этот дисплей позволяет быстро рисовать 16-цветные изображения. Данные о цвете передаются по входам
I (интенсивность), R (красная компонента), G (зеленая компонента), B (синяя компонента) параллельно.
При каждом перепаде L->H на SYN данные с этих входов считываются и используются для рисования
текущего пикселя. Назначение остальных входов, окон и страницы свойств такое же, что и у
<a href="#display">первого варианта дисплея</a>.
</p>

<a name="display-analog"></a>
<h4>3.6.19. Дисплей RGB с аналоговыми входами</h4>

<IMG src="images/elements-new/display3.png" width="235" height="232" border="0">

<p style="text-align: justify">
Аналогичен <a href="#display-irgb">предыдущему</a>, но входы RGB принимают аналоговый сигнал 
в диапазоне от 0 до 3 В. Позволяет быстро отображать полноцветные изображения. 
Назначение остальных входов, окон и страницы свойств такое же, что и у
<a href="#display">первого варианта дисплея</a>.
</p>

<p style="text-align: justify">
Например, можно без особого труда нарисовать такое изображение:
</p>

<IMG src="images/elements-new/displaywindow2.png" width="323" height="388" border="0">

<a name="breakpoint1"></a>
<h4>3.6.20. Останов по сигналу</h4>

<IMG src="images/elements-new/breakpoint1.png" width="111" height="31" border="0">

<p style="text-align: justify">
Этот элемент используется для приостановки симуляции при приходе заданного сигнала. 
Симуляция приостанавливается при перепаде L->H или H->L на входе элемента в зависимости от
настройки. Страница свойств выглядит так:
</p>

<IMG src="images/elements-new/breakpoint1prop.png" width="472" height="315" border="0">

<p style="text-align: justify">
Можно выбрать, по какому изменению сигнала производить останов, а также разрешить или
запретить его вообще. Параметр "Задержка" показывает, через сколько условных наносекунд
произвести останов после перепада уровня на входе.
</p>

<a name="breakpoint8"></a>
<h4>3.6.21. Останов по данным</h4>

<IMG src="images/elements-new/breakpoint8.png" border="0">

<p style="text-align: justify">
Используется для приостановки симуляции, когда на входе элемента окажется байт из
заданного диапазона. Здесь можно настроить следующие параметры:
</p>

<IMG src="images/elements-new/breakpoint8prop.png" width="472" height="315" border="0">

<p style="text-align: justify">
Можно разрешить или запретить точку останова, указать диапазон, в который должен попасть
входной байт. Также можно выбрать, должен ли останов производиться при попадании байта
внутрь диапазона или вне его. Параметр "Задержка" показывает, через сколько условных наносекунд
произвести останов после перепада уровня на входе.
</p>

<a name="comm"></a>
<h4>3.6.22. Коммуникационный интерфейс</h4>

<IMG src="images/elements-new/comm.png" width="160" height="196" border="0">

<p style="text-align: justify">
Данный элемент используется для доступа к реальным коммуникационным портам, доступным 
на компьютере, на котором работает симулятор. В моделируемых схемах его можно
использовать аналогично <a href="#pipe">программному каналу</a>. 
</p>

<p style="text-align: justify">
Элемент рассчитан на использование последовательных (COM) портов. Потенциально можно
использовать и параллельный (LPT) порт, однако такая работа не проверялась, кроме того, 
настраиваемые параметры приспособлены именно под последовательный интерфейс. 
</p>

<p style="text-align: justify">
Данные в элемент или из него передаются посредством двунаправленных трехстабильных выводов
D<sub>0</sub> - D<sub>7</sub>. Вход CS служит для выбора элемента и разрешает обмен по шине 
данных D<sub>i</sub>. Входы RD и WR используются для подачи управляющих сигналов чтения и записи
соответственно. Активным уровнем для CS, RD, WR является низкий логический уровень. 
</p>

<p style="text-align: justify">
Сигналы RDYR и RDYW (активный уровень H) показывают готовность данных для чтения или 
возможность записи в данный момент. Активный уровень (H) на выходе ERR говорит о том, 
что произошла ошибка (например, не удалось открыть интерфейс для работы с ним).
</p>

<p style="text-align: justify">
Запись байта в элемент с помощью сигнала WR=L приводит к занесению его во внутренний буфер,
причем любое изменение сигнала на входах D<sub>i</sub> отразится на содержимом буфера. 
После снятия активного уровня с WR байт будет отправлен на выбранный коммуникационный интерфейс 
(например, COM1), если это возможно. При этом до отправки RDYW устанавливается в неактивное (L)
состояние, а после отправки возвращается в активное. Если во время отправки в элемент будет 
записан еще один байт, он будет потерян. 
</p>

<p style="text-align: justify">
Чтение байтов есть смысл производить, когда RDYR активен. Таковым он станет, если какие-то
данные получены по интерфейсу. Если получаемые байты не считывать, они накапливаются во 
внутреннем буфере и, таким образом, не теряются. При чтении байта он извлекается из буфера
и выдается на выходы D<sub>i</sub>. Если чтение происходит в тот момент, когда буфер пуст,
считывается нулевой байт.
</p>

<p style="text-align: justify">
Перепад L->H на входе RES приводит к сбросу. При этом происходит очистка буферов и 
сброс ошибочного состояния, если ранее происходила ошибка.
</p>

<p style="text-align: justify">
Активный (H) уровень на входе BRK приводит к приостановке (BREAK) передачи. Передача 
будет возобновлена при снятии активного уровня с BRK. 
</p>

<br>

<p style="text-align: justify">
Настраиваемых параметров довольно много. Окно настройки показано на рисунке:
</p>

<IMG src="images/elements-new/comm-wnd.png" width="427" height="582" align="middle" border="0">

<p>Параметры:</p>

<ul>
<li>Имя интерфейса - показывает имя коммуникационного интерфейса, например COM1 или COM2</li>
<li>Скорость в бодах. Зависит от типа интерфейса, его контроллера и выбирается обычно из
    стандартного ряда 110, 300, 600, 1200, 2400, 4800, 9600, 19200, 38400, 56000, 57600, 
    115200, 128000, 256000</li>
<li>Проверка на четность. Можно ее совсем выключить или указать тип бита четности
    (дополняющий до четности, дополняющий до нечетности, единица, ноль)</li>
<li>Число стоп-бит. Может быть 1, 1.5, 2</li>
<li>Размер байта. Точнее, это число бит между стартовым и первым стоповым</li>
<li>
<p style="text-align: justify">
Управление потоком. Может использоваться программное управление XON/XOFF 
или аппаратное с помощью линий CTS, DSR, DTR или RTS
</p>
<p style="text-align: justify">
Программное управление потоком XON/XOFF предполагает использование специальных символов, играющих роль
команд приостановки/возобновления передачи. Если приемник не может больше принимать данных, 
он отправляет символ XOFF, передатчик должен его принять и прекратить передачу. Символ XON,
наоборот, возобновляет передачу. Понятно, что обе стороны должны быть настроены одинаково:
т.е. использовать один тип управления потоком и одинаковые символы XON и XOFF. 
</p>
<p style="text-align: justify">
Аппаратное управление потоком использует отдельные контакты интерфейса (CTS, RTS, DSR, DTR)
для приостановки/возобновления передачи. Это не требует использования специальных символов. 
Можно использовать сигналы CTS или DSR для управления исходяющим потоком: если они неактивны,
передача приостанавливается до тех пор, пока они снова не придут в активное состояние.
Эту возможность можно включить, но по умолчанию она выключена. Также используются линии DTR
и RTS.
</p>
<p style="text-align: justify">
Также может потребоваться задать пределы числа принятых байтов во входном буфере: 
высший (предел XON, при котором отправляется команда приостановить передачу) и низший
(предел XOFF, при котором отправляется команда разрешения). Оба этих числа не должны быть
равны нулю.
</p>
</li>
<li>Есть также возможность задать коды символов ошибки, EOF и Evt</li>
</ul>

<p style="text-align: justify">Кнопка "Считать параметры" определяет текущие параметры
выбранного интерфейса, если это возможно, и заполняет поля формы соответствующим образом</p>

<p style="text-align: justify">Кнопка "Проверить параметры" пытается установить
выбранные в форме параметры как текущие для выбранного интерфейса. После этого
считывает параметры и заполняет форму уже корректными данными</p>

<p style="text-align: justify">Нажатие кнопки "Дополнительно" приводит к отображению
еще одного окна настройки:</p>

<IMG src="images/elements-new/comm-wnd2.png" width="471" height="314" border="0">

<p style="text-align: justify">
Здесь задаются, во-первых, таймауты записи. Общий таймаут зависит от число записываемых
за операцию байтов и равен постоянному таймауту плюс множителю, умноженному на число байт.
Эти величины задаются в миллисекундах ("реальных"), можно попробовать поменять их с целью улучшения
производительности, хотя значения по умолчанию подходят неплохо.
</p>

<p style="text-align: justify">Интервал опроса задает время между последовательными
опросами состояния интерфейса. Задается в условном времени симуляции (в наносекундах)</p>

<p style="text-align: justify">
Размеры буфера, задаваемые здесь, являют собой лишь "подсказки" для драйвера. Реально
выбранный размер буфера в полной мере зависит от драйвера и не может быть установлен
вручную.
</p>

<p style="text-align: justify">
Следует отметить, что несколько процессов не могут использовать один порт
одновременно. Также для использования данного плагина могут потребоваться определенные права.
</p>

<p><a href="#top">К началу</a></p>

</body>
</html>